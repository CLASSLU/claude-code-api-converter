name: Simple Test Workflow

on:
  push:
    branches: [master]
  pull_request:
    types: [opened]

jobs:
  basic-test:
    runs-on: ubuntu-latest
    name: APIè¿æ¥æµ‹è¯•

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Test API Call
      run: |
        echo "ğŸ§ª æµ‹è¯•APIè¿æ¥..."

        # ç®€å•çš„APIæµ‹è¯•
        RESPONSE=$(curl -s -X POST "https://apis.iflow.cn/v1/chat/completions" \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.UPSTREAM_API_KEY }}" \
          -d '{
            "model": "glm-4.6",
            "max_tokens": 100,
            "messages": [{"role": "user", "content": "ç®€å•æµ‹è¯•"}]
          }')

        echo "APIå“åº”: $RESPONSE"

        # æ£€æŸ¥å“åº”æ˜¯å¦åŒ…å«content
        if echo "$RESPONSE" | grep -q "content"; then
          echo "âœ… APIæµ‹è¯•æˆåŠŸ"
        else
          echo "âŒ APIæµ‹è¯•å¤±è´¥"
          exit 1
        fi