name: Simple Test Workflow

on:
  push:
    branches: [master]
  pull_request:
    types: [opened]

jobs:
  basic-test:
    runs-on: ubuntu-latest
    name: API连接测试

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Test API Call
      run: |
        echo "🧪 测试API连接..."

        # 简单的API测试
        RESPONSE=$(curl -s -X POST "https://apis.iflow.cn/v1/chat/completions" \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ secrets.UPSTREAM_API_KEY }}" \
          -d '{
            "model": "glm-4.6",
            "max_tokens": 100,
            "messages": [{"role": "user", "content": "简单测试"}]
          }')

        echo "API响应: $RESPONSE"

        # 检查响应是否包含content
        if echo "$RESPONSE" | grep -q "content"; then
          echo "✅ API测试成功"
        else
          echo "❌ API测试失败"
          exit 1
        fi